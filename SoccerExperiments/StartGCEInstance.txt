# ----------------------------------------------------------
# Steps to run experiments on Google Compute Engine instance
# ----------------------------------------------------------

# Connect to Virtual Machine using SSH
gcloud compute ssh instance-for-ml-agents
gcloud compute ssh second-instance-for-ml-agents

# Delete old experiment files
rm -r -f StartTrainingOnGCE.sh
rm -r -f nohup.out
rm -r -f -d models
rm -r -f -d summaries
rm -r -f -d master-thesis

# Transfer StartTrainingOnGCE.sh file to server (RUN ON ANOTHER TERMINAL WINDOW)
gcloud compute scp --recurse /Users/rsaenz/Documents/Projects/master-thesis/SoccerExperiments/StartTrainingOnGCE.sh instance-for-ml-agents:/home/rsaenz/
gcloud compute scp --recurse /Users/rsaenz/Documents/Projects/master-thesis/SoccerExperiments/StartTrainingOnGCE.sh second-instance-for-ml-agents:/home/rsaenz/

# Verify StartTrainingOnGCE.sh content
cat StartTrainingOnGCE.sh

# Make .sh file executable
chmod +x StartTrainingOnGCE.sh

# Run .sh file independenly of SSH connection
nohup ./StartTrainingOnGCE.sh &

# Monitor log file
tail -f nohup.out

# Check if sh file is running
ps aux | grep "StartTrainingOnGCE.sh"


---------------------------

# Connect to my macbook
ssh rsaenzi@MacBook-Pro-Rigoberto.local
cd Documents/Projects/master-thesis/SoccerExperiments
tail -f nohup.out

	Control+D to close connection


# Delete previous files
rm -r -f -d models
rm -r -f -d summaries
rm -r -f -d master-thesis

# Download master-thesis
git clone -b master https://github.com/rsaenzi/master-thesis.git

# Test ml-agents
mlagents-learn -h

# Run experiments
mlagents-learn 'master-thesis/SoccerExperiments/TrainingConfigPPO.yaml' --env='master-thesis/SoccerExperiments/builds/linux/Linux_v11_4fields.x86_64' --run-id=PPO_CurriculaA --num-envs 1 --curriculum 'master-thesis/SoccerExperiments/TrainingCurriculaA.yaml' --no-graphics --force

# Get experiments (run on other terminal windows that has not a ssh open connection)
gcloud compute scp --recurse instance-for-ml-agents:/home/rsaenz/models /Users/rsaenz/Desktop/Experiments_PPO_CurriculaA
gcloud compute scp --recurse instance-for-ml-agents:/home/rsaenz/summaries /Users/rsaenz/Desktop/Experiments_PPO_CurriculaA

# Launch Jupyter Notebooks web client
jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser &

# Open Jupyter Notebook web client
http://104.154.139.227:8888/
http://104.154.139.227:8888/?token=37536be81c20f363915649de2e3c8e9552c32216fcb7e925

# Create SSH key
cd /home/rsaenz/.ssh/
ssh-keygen -t rsa -f ~/.ssh/ssh_key_compute_engine -C rsaenz
cat ssh_key_compute_engine.pub

# To edit a file
vim /etc/vsftpd.conf

# Install Unity
sudo ./UnityInstaller --unattended --components=Unity --install-location=/opt/Editor/Unity

# Copy license file
cp /home/rsaenz/UnityLicense.x.ulf /opt/Editor/Unity/Editor

# Move license file
mv 'Unity_v2019.1.0f2.alf' '/home/rsaenz/'

# Add Unity to project path
# Run 'cd /opt/Editor/Unity/Editor; ./Unity'
export PATH=$PATH:/opt/Editor/Unity/Editor
export PATH=$PATH:/usr/local/lib/python3.7/
echo $PATH

# Request license
./Unity -nographics -logFile -batchmode -createManualActivationFile

# Install license
./Unity -nographics -logFile -batchmode -manualLicenseFile '/home/rsaenz/UnityLicense.x.ulf'

# Open Project (Update API)
Unity -nographics -logFile -batchmode -accept-apiupdate -buildTarget Linux64 -projectPath '/master-thesis/SoccerAcademy' -quit

# Build Project
Unity -nographics -logFile -batchmode -buildTarget Linux64 -buildLinux64Player 'SoccerAcademy.x86_64' -quit

# Run experiments
mlagents-learn 'master-thesis/SoccerExperiments/TrainingConfigPPO.yaml' --env='master-thesis/SoccerExperiments/builds/linux/Linux_v11_4fields.x86_64' --run-id=PPO_curriculaA_test --num-envs 1 --curriculum 'master-thesis/SoccerExperiments/TrainingCurriculaA.yaml' --no-graphics --force
